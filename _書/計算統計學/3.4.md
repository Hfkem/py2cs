## 3.4 全機率公式

在機率論中，機率是一種用數字描述事件發生可能性的方式，通常介於 0 與 1 之間。當事件不可能發生時，其機率為 0；當事件必然發生時，其機率為 1。而全機率公式則是一種用來計算機率的方法，尤其是在多種獨立或相依的事件中，用來計算事件的聯合機率。

假設有 $n$ 種事件 $B_1, B_2, ..., B_n$，且這些事件所對應到的樣本空間 $S$ 可以被分成互不重疊的 $n$ 個事件 $A_1, A_2, ..., A_n$，且每個事件 $A_i$ 都與事件 $B_1, B_2, ..., B_n$ 中的一個事件相對應，且此一事件發生機率為 $P(B_i)$。則任何一種事件 $C$ 的機率可以按照以下公式求得：

$$P(C) = \sum_{i=1}^{n} P(A_i) \cdot P(C|A_i)$$

其中， $P(A_i)$ 是事件 $A_i$ 發生的機率，也就是 $A_i$ 在樣本空間 $S$ 中所佔的比例； $P(C|A_i)$ 是在事件 $A_i$ 發生的條件下，事件 $C$ 發生的機率。

透過全機率公式，我們可以計算出一個複合事件（composite event）的機率，該複合事件包括所有可能的情況，每種情況的機率都已知。在實際應用中，全機率公式可以幫助我們預測潛在的風險和機會，以及定義採取的相對策略。

在 Python 中，我們可以使用 SciPy 模組中的 stats 函式庫來進行全機率公式的實作。以下是一個簡單的範例：

```python
from scipy import stats

# 定義每一種事件發生的機率
p_A1 = 0.2
p_A2 = 0.3
p_A3 = 0.5

# 定義在每一種事件發生的條件下，事件 B1 和 B2 發生的機率
p_B1_given_A1 = 0.8
p_B1_given_A2 = 0.5
p_B1_given_A3 = 0.2
p_B2_given_A1 = 0.2
p_B2_given_A2 = 0.5
p_B2_given_A3 = 0.8

# 使用全機率公式計算事件 B1 和 B2 的機率
p_B1 = p_A1 * p_B1_given_A1 + p_A2 * p_B1_given_A2 + p_A3 * p_B1_given_A3
p_B2 = p_A1 * p_B2_given_A1 + p_A2 * p_B2_given_A2 + p_A3 * p_B2_given_A3

print("P(B1) = %.2f" % p_B1)
print("P(B2) = %.2f" % p_B2)
```

這段程式碼定義了三種不同的事件 $A_1, A_2, A_3$ 和在每個事件發生條件下的事件 $B_1$ 和 $B_2$ 的機率。最後，我們使用全機率公式計算了事件 $B_1$ 和 $B_2$ 的機率，並透過 `print` 函式將結果顯示在螢幕上。