## 第四章：馬爾可夫鏈

# 馬爾可夫鏈概述

馬爾可夫鏈（Markov Chain）是以一定的機率過渡到相應狀態的數學模型。這種模型中，從當前狀態（或時刻）到下一個狀態（或下一個時刻）的過程只取決於當前狀態（或時刻）。

更形式化地說，設 $S$ 為狀態空間，對於所有 $i,j \in S$，滿足

$$
P(X_{t+1}=j|X_0=i_0,X_1=i_2,…,X_t=i_t) = P(X_{t+1}=j|X_t=i)
$$

其中， $X_t$ 表示在時間 $t$ 的狀態，這個公式是說，在給定歷史狀態的條件下，跳轉到下一個狀態 $j$ 的機率只和當前的狀態 $i$ 有關。

馬爾可夫鏈最常見的例子是隨機遊走模型，即一個人在一條直線上，以機率 $p$ 往右走一步，以機率 $1-p$ 往左走一步。該模型中，狀態空間由整數 $\{1, 2, \dots, n\}$ 構成，每個狀態 $i$ 決定了向右或向左的方向。如果下一步的選擇不僅由當前的狀態，而且還受到當前已經走的步數影響，就不能使用馬爾可夫鏈描述。

馬爾可夫鏈的特殊性質可以使其在多方面得到應用，例如：隨機過程建模、自然語言處理、計算機視覺、時間序列預測、機器學習等方面。

# 狀態轉移矩陣

馬爾可夫鏈的狀態可以看作一個隨機過程，狀態轉移矩陣 $P$ 描述了從當前狀態轉移到將要到達狀態的機率。 $P_{ij}$ 表示當當前狀態爲 $i$ 時，轉移到下一個狀態 $j$ 的概率，即

$$
P_{ij} = P(X_{n+1} = j \mid X_{n} = i)
$$

矩陣 $P$ 的每一行表示當前的狀態，每一列表示轉移到的狀態，因此 $P$ 是一個 $n \times n$ 的轉移矩陣，其中 $n$ 是狀態的個數。

馬爾可夫鏈的一個重要性質是：轉移矩陣 $P$ 的行之和為 1。這意味著從任何一個狀態出發，轉移到其他狀態的機率之和為 1。

# 平稳狀態

如果狀態轉移矩陣 $P$ 的某個行向量 $\pi$ 滿足以下條件：

$$
\pi P = \pi
$$

那麼， $\pi$ 被稱為馬爾可夫鏈的平稳狀態。直觀地說，平稳狀態是當時間趨於無限大時，狀態分布不再發生變化的狀態。

平稳狀態的存在和唯一性是馬爾可夫鏈的兩個重要性質。對於有限的、不可逆的、正常的馬爾可夫鏈，平稳狀態總是存在且唯一。

# 馬爾可夫鏈在 Python 中的實現

Python 中，NumPy、SciPy 和 Pandas 都提供了計算馬爾可夫鏈的函數。下面我們使用以下的轉移矩陣和初始狀態來構造一個馬爾可夫鏈。

$$
P = \begin{bmatrix} 0.7 & 0.3 & 0.0 \\ 0.4 & 0.4 & 0.2 \\ 0.2 & 0.5 & 0.3 \\ \end{bmatrix}, \quad \pi = \begin{bmatrix} 0.2 \\ 0.3 \\ 0.5 \\ \end{bmatrix}
$$

為了構建馬爾可夫鏈，我們可以使用 NumPy 和 SciPy 函數庫中的以下函數。

- `numpy.random.choice`：從給定的一個一維數組中生成指定形狀的隨機數組，並且可以按照指定的機率分配生成數組中的數值。
- `scipy.linalg`：線性代數函數庫，其中包含了進行矩陣操作的工具，例如矩陣的乘法、行列式的計算等。

以下是使用 NumPy 和 SciPy 的代碼實現。在此例中，我們生成的馬爾可夫鏈包括 100 個狀態。

``` python
import numpy as np
from scipy.linalg import matrix_power

P = np.array([[0.7, 0.3, 0.0], [0.4, 0.4, 0.2], [0.2, 0.5, 0.3]])
pi = np.array([0.2, 0.3, 0.5])

# simulate a Markov Chain with 100 steps
mc = [np.random.choice([0, 1, 2], p=pi)]
for i in range(1, 100):
    mc.append(np.random.choice([0, 1, 2], p=P[mc[i-1], :]))

mc = np.array(mc)
mc_transitions = np.zeros((3, 3))
for i in range(1, len(mc)):
    mc_transitions[mc[i-1], mc[i]] += 1

mc_transitions /= np.sum(mc_transitions, axis=1)[:, np.newaxis]
```

# 參考文獻

- Ross, S. M. (2014). Introduction to Probability Models (Tenth Edition). Academic Press.